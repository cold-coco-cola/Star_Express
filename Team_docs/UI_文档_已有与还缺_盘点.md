# 星穹铁道 — UI 文档「已有 vs 还缺」盘点

> 基于当前 [UI_星穹铁道.md](UI_星穹铁道.md) 与 [PRD_星穹铁道.md](PRD_星穹铁道.md) 的对照，供技术端 Agent 实施与后续优化参考。

---

## 1. 已有内容（可直接使用）

| 章节 | 内容 | Agent 使用方式 |
|------|------|----------------|
| **§0** | 面向 Agent 的实施说明、文档使用方式、命名规范、数据绑定约定 | 按 §0.1 查表确定做哪一步时看哪一章；命名与数据约定写代码时严格遵守 |
| **§2** | 界面层级（World / HUD / Overlay）、界面清单与出现/关闭时机 | 建场景时按层级创建 Canvas；Overlay 的 Sorting Order > HUD |
| **§3** | 各界面控件与交互（主玩法、HUD、选色、本周奖励、放置模式、取消航线、失败/结算） | 理解「谁在什么时机出现、点击后发生什么」；具体组件与事件名见 §7（见下） |
| **§4.1** | 全局 UI 状态枚举及含义、允许的操作 | 实现 `GameplayUIState` 枚举与状态机时与表一致 |
| **§4.2** | 状态转换 Mermaid 图 | 理解主流程；注意「点击已有 A–B 线」分支在 §4 补充表中 |
| **§4.3** | 与游戏逻辑的对接点（分数/资源/拥挤/选中放置） | 与 Game 层约定事件名与调用方；具体事件名见 §7 |
| **§5** | 视觉规范（形状/颜色）、反馈动效、Unity 实现建议 | 美术与实现参考；World Space / Screen Space、射线检测、状态机单例 |
| **§6** | 控件与 Prefab 清单（名称、用途、所在界面） | Prefab/GameObject 命名与挂载位置；与 §7 一一对应 |

---

## 2. 还缺内容（已补或建议补）

### 2.1 文档内引用但原先缺失（已补）

| 项 | 说明 | 处理 |
|----|------|------|
| **§7 控件规格表** | §0.1 写明「实现具体控件看 §3 + §7」「对接游戏逻辑看 §7 数据源列」，但原文档无 §7 | 已在 UI 文档中新增 **§7 控件规格与数据/事件表**：每个控件的 Unity 组件类型、数据源/订阅事件、触发调用、边界条件 |
| **§8 实施检查清单** | §0.1 写明「自检与验收看 §8」，但原文档无 §8 | 已在 UI 文档中新增 **§8 实施与验收检查清单**：可勾选的自检项（场景层级、Prefab、状态机、事件对接、交互边界） |
| **§4.2.1 完整状态转换表** | 状态图缺少「点击已有 A–B 线」「取消航线」的显式分支 | 已在 UI 文档 §4 下新增 **§4.2.1 完整状态转换表**：表格列出所有合法「当前状态→触发条件→下一状态」，并注明非法转换 |

### 2.2 状态机与 PRD 对齐（已落实）

| 项 | 说明 | 状态 |
|----|------|------|
| **「点击已有 A–B 线」分支** | 第一击选站 A、第二击选站 B 时，若 A–B 间已有某颜色线：PRD 为「取消该段」或「添加另一颜色」 | 已在 §4.2.1 表中增加：LineFirstSelected + 点击 B 且已有 A–B 线 → Idle 或进入取消该段流程 |
| **LineRemoving 的入口与出口** | 从 Idle 点击航线段并确认取消 → LineRemoving；段移除后 → Idle | 已在 §4.2.1 表中明确 |

### 2.3 与 PRD 字段/规则的对齐（可选精细化）

| PRD 内容 | UI 文档现状 | 建议 |
|----------|-------------|------|
| **资源发放**：周 0 不发放，满 60 秒后首次发放；轮换「客舱→空间站→星隧→客舱…」 | §3.4 写「每经过 1 游戏周」；未写轮换顺序 | 在 §3.4 或 §7 WeekRewardPopup 的「数据源」中注明：首次发放时机=周 0 结束；奖励列表按轮换顺序生成 |
| **站点解锁**：阶段一固定周数、阶段二随机池 | §3.1 写「未解锁时灰显或不可点」 | 已够用；若需可加一句：解锁节奏见 PRD §3.1 |
| **queueCapacity / crowdingThreshold** | §3.1 有「排队人数」「拥挤度条」「拥挤阈值」 | 在 §7 StationView 数据源中明确：显示用 `waitingPassengers.Count`、阈值用 `crowdingThreshold`、可选 `queueCapacity` |
| **Hub 放置**：仅可放在无 Hub 的站 | §3.5 已写「高亮未放置 Hub 的站点」 | 已对齐 |

---

## 3. 实施顺序建议（Agent）

1. **建场景与 Canvas**：按 §2 建 World / HUD / Overlay 及 Sorting Order。  
2. **建 Prefab**：按 §6 清单建各 Prefab，按 §7 挂组件与子节点。  
3. **接数据与事件**：按 §7「数据源/订阅事件」「触发调用」对接 Game 层。  
4. **实现状态机**：按 §4.1 + §4 完整转换表实现 `GameplayUIController`，仅允许表中转换。  
5. **自检**：按 §8 逐项勾选验收。

---

## 4. 小结

- **已有**：§0、§2、§3、§4.1–4.3、§5、§6 已具备，可直接支撑实现与对接。  
- **已补**：§7（控件规格与数据/事件表）、§8（实施检查清单）已写入 UI 文档。  
- **建议**：在 §4 增加完整状态转换表（含「已有 A–B 线」与「取消航线」入口）；§7/§3.4 与 PRD 资源发放、拥挤阈值的字段可再细化为可选。

文档结束。
